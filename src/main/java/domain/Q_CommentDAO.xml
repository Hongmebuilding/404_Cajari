<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="domain.Q_CommentDAO">

	<resultMap type="domain.UserDTO" id="mapUser">
		<result column="u_id" property="id"/>
		<result column="u_username" property="username"/>
		<result column="u_password" property="password"/>
		<result column="u_name" property="name"/>
		<result column="u_authorities" property="authorities"/>
		<result column="u_regdate" property="regDate"/>
		<result column="u_car_name" property="car_name"/>
		<result column="u_car_number" property="car_number"/>
		<result column="u_phone_number" property="phone_number"/>
	</resultMap>
	
	<resultMap type="domain.Qna_WriteDTO" id="mapQnaWrite">
		<result column="r_id" property="id"/>
		<result column="r_subject" property="subject"/>
		<result column="r_content" property="content"/>
		<result column="r_viewcnt" property="viewcnt"/>
		<result column="r_regdate" property="regDate"/>
		<collection property="user_id" resultMap="mapUser"/>
	</resultMap>
	
	<resultMap type="domain.Q_CommentDTO" id="mapQComment">
	    <result column="q_id" property="id"/>
	    <result column="q_content" property="content"/>
	    <result column="q_regdate" property="regDate"/>
	    <collection property="user_id" resultMap="mapUser"/>
	    <collection property="qna_id" resultMap="mapQnaWrite"/>
	    
	</resultMap>
	
	<select id="selectByWrite" resultMap="mapQComment">
	    SELECT
	        q.id "q_id",
	        q.content "q_content",
	        q.regdate "q_regdate",
	        u.id "u_id",
	        u.username "u_username",
	        u.password "u_password",
	        u.name "u_name",
	        u.authorities "u_authorities",
	        u.regdate "u_regdate"            
	    FROM t404_qna_comment q, t404_user u
	    WHERE
	        q.user_id = u.id
	        AND q.qna_id = #{param1}
	    ORDER BY q.id DESC
	</select>
	
	<insert id="insert" flushCache="true" parameterType="domain.Q_CommentDTO"
    keyProperty="id" useGeneratedKeys="true" keyColumn="id">
    INSERT INTO t404_qna_comment(user_id, qna_id, content)
    VALUES(#{user_id.id}, #{qna_id.id}, #{content})
	</insert>
	
	<delete id="deleteById" flushCache="true">
    DELETE FROM t404_qna_comment WHERE id = #{id}
	</delete>
	


</mapper>