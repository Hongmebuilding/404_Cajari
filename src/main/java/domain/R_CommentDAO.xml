<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="domain.R_CommentDAO">

	<resultMap type="domain.UserDTO" id="mapUser">
		<result column="u_id" property="id"/>
		<result column="u_username" property="username"/>
		<result column="u_password" property="password"/>
		<result column="u_name" property="name"/>
		<result column="u_authorities" property="authorities"/>
		<result column="u_regdate" property="regDate"/>
		<result column="u_car_name" property="car_name"/>
		<result column="u_car_number" property="car_number"/>
		<result column="u_phone_number" property="phone_number"/>
	</resultMap>
	
	<resultMap type="domain.ParkingDTO" id="mapParking">
		<result column="p_id" property="id"/>
		<result column="p_addr" property="addr"/>
		<result column="p_weekend_begin_time" property="weekend_begin_time"/>
		<result column="p_weekend_end_time" property="weekend_end_time"/>
		<result column="p_weekday_begin_time" property="weekday_begin_time"/>
		<result column="p_weekday_end_time" property="weekday_end_time"/>
		<result column="p_holiday_begin_time" property="holiday_begin_time"/>
		<result column="p_holiday_end_time" property="holiday_end_time"/>
		<result column="p_holiday_pay_nm" property="holiday_pay_nm"/>
		<result column="p_fulltime_monthly" property="fulltime_monthly"/>
		<result column="p_weekend_pay_nm" property="weekend_pay_nm"/>
		<result column="p_saturday_pay_nm" property="saturday_pay_nm"/>
		<result column="p_tel" property="tel"/>
		<result column="p_parking_name" property="parking_name"/>
	</resultMap>
	
	<resultMap type="domain.Review_WriteDTO" id="mapWrite">
		<result column="r_id" property="id"/>
		<result column="r_subject" property="subject"/>
		<result column="r_content" property="content"/>
		<result column="r_viewcnt" property="viewcnt"/>
		<result column="r_regdate" property="regDate"/>
		<collection property="user_id" resultMap="mapUser"/>
		<collection property="parking_id" resultMap="mapParking"/>
	</resultMap>
	
	<resultMap type="domain.R_CommentDTO" id="mapRComment">
	    <result column="c_id" property="id"/>
	    <result column="c_content" property="content"/>
	    <result column="c_regdate" property="regDate"/>
	    <collection property="user_id" resultMap="mapUser"/>
	    <collection property="review_write_id" resultMap="mapWrite"/>
	    
	</resultMap>
	
	<select id="selectByWrite" resultMap="mapRComment">
	    SELECT
	        c.id "c_id",
	        c.content "c_content",
	        c.regdate "c_regdate",
	        u.id "u_id",
	        u.username "u_username",
	        u.password "u_password",
	        u.name "u_name",
	        u.authorities "u_authorities",
	        u.regdate "u_regdate"            
	    FROM t404_review_comment c, t404_user u
	    WHERE
	        c.user_id = u.id
	        AND c.write_id = #{param1}
	    ORDER BY c.id DESC
	</select>
	
	<insert id="insert" flushCache="true" parameterType="domain.R_CommentDTO"
    keyProperty="id" useGeneratedKeys="true" keyColumn="id">
    INSERT INTO t404_review_comment(user_id, review_write_id, content)
    VALUES(#{user_id.id}, #{review_write_id.id}, #{content})
	</insert>
	
	<delete id="deleteById" flushCache="true">
    DELETE FROM t404_review_comment WHERE id = #{id}
	</delete>
	


</mapper>